{% extends "core/base.html" %}
{% block title %}Busca Global - SmartSecretaria{% endblock %}

{% block extra_css %}
<style>
  .search-header {
    margin-bottom: 30px;
  }
  
  .search-form {
    margin-bottom: 20px;
  }
  
  .search-form input[type="text"] {
    padding: 10px;
    width: 70%;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
  }
  
  .search-form button {
    padding: 10px 20px;
    background-color: #0d6efd;
    border: none;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
  }
  
  .search-form button:hover {
    background-color: #0b5ed7;
  }
  
  .search-results-section {
    margin-bottom: 30px;
  }
  
  .search-results-section h2 {
    margin-bottom: 15px;
    padding-bottom: 5px;
    border-bottom: 1px solid #eee;
  }
  
  .search-result-item {
    padding: 10px;
    margin-bottom: 10px;
    border-left: 3px solid #0d6efd;
    background-color: #f8f9fa;
  }
  
  .search-result-item:hover {
    background-color: #e9ecef;
  }
  
  .search-result-item a {
    text-decoration: none;
    color: #0d6efd;
    font-weight: bold;
  }
  
  .search-result-item p {
    margin: 5px 0 0;
    color: #6c757d;
    font-size: 0.9em;
  }
  
  .no-results {
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 4px;
    text-align: center;
    color: #6c757d;
  }
  
  .search-category-nav {
    margin-bottom: 20px;
    display: flex;
    flex-wrap: wrap;
  }
  
  .search-category-nav a {
    margin-right: 10px;
    margin-bottom: 10px;
    padding: 5px 10px;
    border-radius: 20px;
    background-color: #e9ecef;
    color: #495057;
    text-decoration: none;
    font-size: 0.9em;
  }
  
  .search-category-nav a:hover,
  .search-category-nav a.active {
    background-color: #0d6efd;
    color: white;
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <div class="search-header">
    <h1>Busca Global</h1>
    <p>Busque por alunos, professores, turmas, documentos e mais.</p>
  </div>
  
  <div class="search-form">
    <form method="get" action="{% url 'core:busca_global' %}">
      <input type="text" name="q" value="{{ query }}" placeholder="Digite pelo menos 3 caracteres para buscar..." required minlength="3">
      <button type="submit">Buscar</button>
    </form>
  </div>
  
  {% if query %}
    {% if tem_resultados %}
      <div class="search-category-nav">
        {% if resultados.alunos %}
          <a href="#alunos">Alunos ({{ resultados.alunos|length }})</a>
        {% endif %}
        
        {% if resultados.professores %}
          <a href="#professores">Professores ({{ resultados.professores|length }})</a>
        {% endif %}
        
        {% if resultados.turmas %}
          <a href="#turmas">Turmas ({{ resultados.turmas|length }})</a>
        {% endif %}
        
        {% if resultados.documentos %}
          <a href="#documentos">Documentos ({{ resultados.documentos|length }})</a>
        {% endif %}
        
        {% if resultados.eventos %}
          <a href="#eventos">Eventos ({{ resultados.eventos|length }})</a>
        {% endif %}
        
        {% if resultados.matriculas %}
          <a href="#matriculas">Matrículas ({{ resultados.matriculas|length }})</a>
        {% endif %}
      </div>
      
      <!-- Resultados de Alunos -->
      {% if resultados.alunos %}
        <div id="alunos" class="search-results-section">
          <h2>Alunos</h2>
          {% for aluno in resultados.alunos %}
            <div class="search-result-item">
              <a href="{% url 'aluno:detalhe_aluno' aluno.id %}">{{ aluno.nome_completo }}</a>
              <p>CPF: {{ aluno.cpf }}</p>
              <p>Data de Nascimento: {{ aluno.data_nascimento }}</p>
              {% if aluno.turma %}
                <p>Turma: {{ aluno.turma.nome }}</p>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <!-- Resultados de Professores -->
      {% if resultados.professores %}
        <div id="professores" class="search-results-section">
          <h2>Professores</h2>
          {% for professor in resultados.professores %}
            <div class="search-result-item">
              <a href="{% url 'professor:detalhe_professor' professor.id %}">{{ professor.nome }}</a>
              <p>Email: {{ professor.email }}</p>
              <p>Disciplina: {{ professor.disciplina }}</p>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <!-- Resultados de Turmas -->
      {% if resultados.turmas %}
        <div id="turmas" class="search-results-section">
          <h2>Turmas</h2>
          {% for turma in resultados.turmas %}
            <div class="search-result-item">
              <a href="{% url 'turma:detalhe_turma' turma.id %}">{{ turma.nome }}</a>
              <p>Série: {{ turma.serie }}</p>
              <p>Período: {{ turma.periodo }}</p>
              <p>Sala: {{ turma.sala }}</p>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <!-- Resultados de Documentos -->
      {% if resultados.documentos %}
        <div id="documentos" class="search-results-section">
          <h2>Documentos</h2>
          {% for documento in resultados.documentos %}
            <div class="search-result-item">
              <a href="{% url 'documentos:detalhe_documento' documento.id %}">{{ documento.get_tipo_display }}</a>
              <p>Aluno: {{ documento.aluno.nome_completo }}</p>
              <p>Data de Emissão: {{ documento.data_emissao }}</p>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <!-- Resultados de Eventos -->
      {% if resultados.eventos %}
        <div id="eventos" class="search-results-section">
          <h2>Eventos</h2>
          {% for evento in resultados.eventos %}
            <div class="search-result-item">
              <a href="{% url 'calendario:detalhe_evento' evento.pk %}">{{ evento.titulo }}</a>
              <p>Data: {{ evento.data_inicio }}</p>
              <p>Tipo: {{ evento.get_tipo_display }}</p>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <!-- Resultados de Matrículas -->
      {% if resultados.matriculas %}
        <div id="matriculas" class="search-results-section">
          <h2>Matrículas</h2>
          {% for matricula in resultados.matriculas %}
            <div class="search-result-item">
              <a href="{% url 'matricula:detalhe_matricula' matricula.id %}">Matrícula de {{ matricula.aluno.nome_completo }}</a>
              <p>Turma: {{ matricula.turma.nome }}</p>
              <p>Status: {{ matricula.get_status_display }}</p>
              <p>Ano Letivo: {{ matricula.ano_letivo }}</p>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    
    {% else %}
      <div class="no-results">
        <h2>Nenhum resultado encontrado para "{{ query }}"</h2>
        <p>Tente diferentes termos de busca ou verifique a ortografia.</p>
      </div>
    {% endif %}
  {% else %}
    <div class="search-instructions">
      <h2>Como usar a busca global</h2>
      <ul>
        <li>Digite pelo menos 3 caracteres para iniciar a busca.</li>
        <li>Você pode buscar por nomes, CPF, emails, conteúdo de documentos, etc.</li>
        <li>Os resultados são agrupados por categoria para facilitar a navegação.</li>
      </ul>
    </div>
  {% endif %}
</div>
{% endblock %}