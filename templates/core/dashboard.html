{% extends "core/base.html" %}
{% block title %}Dashboard - SmartSecretaria{% endblock %}

{% block extra_css %}
<style>
  .dashboard-card {
    border: 1px solid #e0e0e0;
    border-radius: 5px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  
  .dashboard-card h3 {
    margin-top: 0;
    border-bottom: 1px solid #f0f0f0;
    padding-bottom: 10px;
    color: #333;
  }
  
  .dashboard-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
  }
  
  .stat-card {
    flex: 1;
    min-width: 200px;
    background-color: #f8f9fa;
    border-radius: 5px;
    padding: 15px;
    text-align: center;
  }
  
  .stat-card .stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #0d6efd;
  }
  
  .stat-card .stat-label {
    font-size: 0.9rem;
    color: #6c757d;
  }
  
  .quick-actions {
    margin-bottom: 20px;
  }
  
  .quick-actions a {
    display: inline-block;
    margin-right: 10px;
    margin-bottom: 10px;
    padding: 10px 15px;
    background-color: #0d6efd;
    color: white;
    text-decoration: none;
    border-radius: 4px;
  }
  
  .quick-actions a:hover {
    background-color: #0b5ed7;
  }
  
  .activity-item {
    padding: 10px 0;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .activity-item:last-child {
    border-bottom: none;
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <h1>Dashboard</h1>
  
  <div class="dashboard-stats">
    <div class="stat-card">
      <div class="stat-value">{{ total_alunos }}</div>
      <div class="stat-label">Alunos</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-value">{{ total_professores }}</div>
      <div class="stat-label">Professores</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-value">{{ total_turmas }}</div>
      <div class="stat-label">Turmas</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-value">{{ total_matriculas }}</div>
      <div class="stat-label">Matrículas Ativas</div>
    </div>
  </div>
  
  <div class="row">
    <div class="col-md-6">
      <div class="dashboard-card">
        <h3>Ações Rápidas</h3>
        <div class="quick-actions">
          <a href="{% url 'aluno:novo_aluno' %}">Novo Aluno</a>
          <a href="{% url 'professor:novo_professor' %}">Novo Professor</a>
          <a href="{% url 'turma:nova_turma' %}">Nova Turma</a>
          <a href="{% url 'matricula:nova_matricula' %}">Nova Matrícula</a>
          <a href="{% url 'calendario:novo_evento' %}">Novo Evento</a>
          <a href="{% url 'documentos:novo_documento' %}">Novo Documento</a>
        </div>
      </div>
      
      <div class="dashboard-card">
        <h3>Próximos Eventos</h3>
        {% if proximos_eventos %}
          <div class="list-group">
            {% for evento in proximos_eventos %}
              <div class="activity-item">
                <div style="display: flex; justify-content: space-between;">
                  <div>
                    <a href="{% url 'calendario:detalhe_evento' evento.pk %}">{{ evento.titulo }}</a>
                  </div>
                  <div>
                    <span style="color: #6c757d;">{{ evento.data_inicio|date:"d/m/Y" }}</span>
                  </div>
                </div>
                {% if evento.tipo == 'feriado' %}
                  <span class="badge bg-danger">Feriado</span>
                {% elif evento.tipo == 'reuniao' %}
                  <span class="badge bg-primary">Reunião</span>
                {% else %}
                  <span class="badge bg-success">Evento</span>
                {% endif %}
              </div>
            {% endfor %}
          </div>
          <div style="margin-top: 10px;">
            <a href="{% url 'calendario:lista_eventos' %}">Ver todos os eventos</a>
          </div>
        {% else %}
          <p>Não há eventos próximos agendados.</p>
        {% endif %}
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="dashboard-card">
        <h3>Últimos Alunos Cadastrados</h3>
        {% if ultimos_alunos %}
          <div class="list-group">
            {% for aluno in ultimos_alunos %}
              <div class="activity-item">
                <div style="display: flex; justify-content: space-between;">
                  <div>
                    <a href="{% url 'aluno:detalhe_aluno' aluno.id %}">{{ aluno.nome_completo }}</a>
                  </div>
                  <div>
                    <a href="{% url 'documentos:lista_documentos' %}?aluno_id={{ aluno.id }}" class="badge bg-secondary">Documentos</a>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
          <div style="margin-top: 10px;">
            <a href="{% url 'aluno:lista_alunos' %}">Ver todos os alunos</a>
          </div>
        {% else %}
          <p>Não há alunos cadastrados.</p>
        {% endif %}
      </div>
      
      <div class="dashboard-card">
        <h3>Atividades Recentes</h3>
        {% if ultimas_atividades %}
          <div class="list-group">
            {% for atividade in ultimas_atividades %}
              <div class="activity-item">
                <div style="display: flex; justify-content: space-between;">
                  <div>{{ atividade.acao }}</div>
                  <div>
                    <span style="color: #6c757d; font-size: 0.85rem;">{{ atividade.data_hora|date:"d/m/Y H:i" }}</span>
                  </div>
                </div>
                <small>{{ atividade.usuario.username }}</small>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p>Não há atividades recentes registradas.</p>
        {% endif %}
      </div>
    </div>
  </div>
  
  <div class="dashboard-card">
    <h3>Informações do Sistema</h3>
    <div class="row">
      <div class="col-md-4">
        <div class="info-item">
          <strong>Versão do Sistema:</strong> 1.0.0
        </div>
        <div class="info-item">
          <strong>Último Login:</strong> {{ user.last_login|date:"d/m/Y H:i" }}
        </div>
      </div>
      <div class="col-md-8">
        <div class="info-item">
          <strong>Documentos Emitidos (Mês Atual):</strong> {{ documentos_mes_atual }}
        </div>
        <div class="info-item">
          <strong>Matrículas (Ano Letivo Atual):</strong> {{ matriculas_ano_atual }}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}