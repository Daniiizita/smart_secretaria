{% extends "core/base.html" %}
{% block title %}Calendário Mensal - SmartSecretaria{% endblock %}


{% block content %}
<div class="container">
  <h1>Calendário - {{ nome_mes }} de {{ ano }}</h1>
  
  {% if messages %}
    <div class="mensagens">
      {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
  <div class="navegacao-filtros" style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
    <div class="row">
      <div class="col-md-6">
        <!-- Navegação de meses -->
        <div class="calendario-navegacao" style="display: flex; justify-content: space-between; align-items: center;">
          <a href="{% url 'calendario:calendario_mensal' %}?mes={{ mes_anterior }}&ano={{ ano_anterior }}" class="btn btn-secondary">« Mês Anterior</a>
          <a href="{% url 'calendario:calendario_mensal' %}" class="btn btn-primary">Hoje</a>
          <a href="{% url 'calendario:calendario_mensal' %}?mes={{ mes_seguinte }}&ano={{ ano_seguinte }}" class="btn btn-secondary">Próximo Mês »</a>
        </div>
      </div>
      <div class="col-md-6">
        <!-- Filtro avançado de data -->
        <form method="get" class="form-inline" style="display: flex; justify-content: flex-end;">
          <div class="form-group" style="margin-right: 10px;">
            <label for="mes" style="margin-right: 5px;">Mês:</label>
            <select name="mes" id="mes" style="padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
              {% for i, nome in meses %}
                <option value="{{ i }}" {% if mes == i %}selected{% endif %}>{{ nome }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group" style="margin-right: 10px;">
            <label for="ano" style="margin-right: 5px;">Ano:</label>
            <select name="ano" id="ano" style="padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
              {% for ano_opcao in anos_disponiveis %}
                <option value="{{ ano_opcao }}" {% if ano == ano_opcao %}selected{% endif %}>{{ ano_opcao }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Ir</button>
        </form>
      </div>
    </div>
    <div class="row" style="margin-top: 10px;">
      <div class="col-md-12" style="text-align: center;">
        <a href="{% url 'calendario:novo_evento' %}" class="btn btn-success">Novo Evento</a>
        <a href="{% url 'calendario:lista_eventos' %}" class="btn btn-info" style="margin-left: 10px;">Lista de Eventos</a>
      </div>
    </div>
  </div>
  
<table class="calendario" style="width: 100%; border-collapse: collapse;">
  <thead>
    <tr>
      <th style="background:#f8f9fa; padding:10px; border:1px solid #ddd; text-align:center;">Dom</th>
      <th style="background:#f8f9fa; padding:10px; border:1px solid #ddd; text-align:center;">Seg</th>
      <th style="background:#f8f9fa; padding:10px; border:1px solid #ddd; text-align:center;">Ter</th>
      <th style="background:#f8f9fa; padding:10px; border:1px solid #ddd; text-align:center;">Qua</th>
      <th style="background:#f8f9fa; padding:10px; border:1px solid #ddd; text-align:center;">Qui</th>
      <th style="background:#f8f9fa; padding:10px; border:1px solid #ddd; text-align:center;">Sex</th>
      <th style="background:#f8f9fa; padding:10px; border:1px solid #ddd; text-align:center;">Sáb</th>
    </tr>
  </thead>
  <tbody>
    {% for week in weeks %}
      <tr>
        {% for cell in week %}
          {% if cell.in_month %}
            <td style="height:100px; border:1px solid #ddd; vertical-align:top; padding:5px;">
              <div style="font-weight:bold;">{{ cell.date.day }}</div>
              {% for evento in cell.events %}
                <div style="margin-top:5px; padding:2px 5px; font-size:0.8em; border-left:3px solid
                  {% if evento.tipo == 'feriado' %}red
                  {% elif evento.tipo == 'reuniao' %}blue
                  {% else %}green{% endif %};">
                  <a href="{% url 'calendario:detalhe_evento' evento.pk %}">
                    {{ evento.titulo|truncatechars:20 }}
                  </a>
                </div>
              {% empty %}
                {# sem eventos para o dia #}
              {% endfor %}
            </td>
          {% else %}
            <td style="height:100px; border:1px solid #eee; background:#f9f9f9;"></td>
          {% endif %}
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>
  
  <div class="legenda" style="margin-top: 20px;">
    <h4>Legenda:</h4>
    <div style="display: flex; gap: 20px;">
      <div><div style="display: inline-block; width: 15px; height: 15px; background-color: red; margin-right: 5px;"></div> Feriado</div>
      <div><div style="display: inline-block; width: 15px; height: 15px; background-color: blue; margin-right: 5px;"></div> Reunião</div>
      <div><div style="display: inline-block; width: 15px; height: 15px; background-color: green; margin-right: 5px;"></div> Evento Escolar</div>
    </div>
  </div>
</div>
{% endblock %}